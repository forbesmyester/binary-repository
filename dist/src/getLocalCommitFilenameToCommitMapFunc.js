"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
const Client_1 = require("./Client");
function toRecord(str) {
    let m = JSON.parse(str);
    if (m === null) {
        return m;
    }
    return {
        sha256: m[0],
        operation: parseInt(m[1]),
        fileByteCount: parseInt(m[2]),
        modifiedDate: new Date(m[5]),
        path: m[6],
        part: m[3].split("_").map(a => parseInt(a, 10)),
        filePartByteCountThreshold: m[4],
        gpgKey: m[7]
    };
}
function default_1({ readFile }, configDir) {
    return (a, next) => {
        readFile(path_1.join(configDir, a.commitType, a.path), { encoding: 'utf8' }, (err, contents) => {
            if (err) {
                return next(err);
            }
            let commit = Object.assign(Client_1.default.infoFromCommitFilename(a.path), {
                record: contents.split(/[\r\n]+/)
                    .map(toRecord)
                    .filter(a => a !== null)
            });
            next(null, commit);
        });
    };
}
exports.default = default_1;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0TG9jYWxDb21taXRGaWxlbmFtZVRvQ29tbWl0TWFwRnVuYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9nZXRMb2NhbENvbW1pdEZpbGVuYW1lVG9Db21taXRNYXBGdW5jLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBR0EsK0JBQTRCO0FBQzVCLHFDQUE4QjtBQU05QixrQkFBa0IsR0FBRztJQUNqQixJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3hCLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUFDLENBQUM7SUFFN0IsTUFBTSxDQUFDO1FBQ0gsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDWixTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QixhQUFhLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3QixZQUFZLEVBQUUsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzVCLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLDBCQUEwQixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDZixDQUFDO0FBQ04sQ0FBQztBQUVELG1CQUF3QixFQUFFLFFBQVEsRUFBZ0IsRUFBRSxTQUFnQztJQUdoRixNQUFNLENBQUMsQ0FBQyxDQUFpQixFQUFFLElBQXNCO1FBQzdDLFFBQVEsQ0FBQyxXQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxFQUFFLENBQUMsR0FBRyxFQUFFLFFBQVE7WUFFaEYsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQUMsQ0FBQztZQUU5QixJQUFJLE1BQU0sR0FBVyxNQUFNLENBQUMsTUFBTSxDQUM5QixnQkFBTSxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFDckM7Z0JBQ0EsTUFBTSxFQUFrQixRQUFRLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQztxQkFDNUMsR0FBRyxDQUFDLFFBQVEsQ0FBQztxQkFDYixNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUM7YUFDM0IsQ0FDSixDQUFDO1lBRUYsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQztBQUNOLENBQUM7QUFwQkQsNEJBb0JDIn0=